<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü–∞—Ä—Å–µ—Ä Google –¢–∞–±–ª–∏—Ü</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 40px;
      background: #f9f9f9;
      color: #333;
    }

    h1 {
      text-align: center;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 20px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    .project {
      background: white;
      border: 1px solid #ddd;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    img {
      max-width: 100%;
      height: auto;
      margin-top: 10px;
    }

    #log {
      margin-top: 40px;
      padding: 20px;
      background: #eee;
      border: 1px solid #ccc;
      font-family: monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>

  <h1>–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ Google –¢–∞–±–ª–∏—Ü—É</h1>

  <input type="text" id="sheet-url" placeholder="https://docs.google.com/spreadsheets/d/... " />
  <button onclick="loadData()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>

  <div id="projects"></div>
  <div id="log">–õ–æ–≥: –æ–∂–∏–¥–∞–Ω–∏–µ...</div>

  <!-- PapaParse -->
  <script src="papaparse.min.js"></script>

  <script>
    function log(message) {
      const logDiv = document.getElementById("log");
      logDiv.textContent += "\n" + new Date().toLocaleTimeString() + " ‚Äî " + message;
      console.log(message); // –¢–∞–∫–∂–µ –≤—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
    }

    function extractCsvUrl(fullUrl) {
      log("–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ CSV-—Å—Å—ã–ª–∫–∏...");
      const match = fullUrl.match(/\/spreadsheets\/d\/([^\/]+)/);
      if (!match || !match[1]) {
        const errorMsg = "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å ID —Ç–∞–±–ª–∏—Ü—ã";
        log("‚ùå –û—à–∏–±–∫–∞: " + errorMsg);
        throw new Error(errorMsg);
      }
      const sheetName = "–õ–∏—Å—Ç1";
      const csvUrl = `https://docs.google.com/spreadsheets/d/ ${match[1]}/gviz/tq?tqx=out:csv&sheet=${sheetName}`;
      log("‚úÖ CSV-—Å—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞: " + csvUrl);
      return csvUrl;
    }

    function loadData() {
      const url = document.getElementById("sheet-url").value.trim();
      log("üîÑ –ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...");

      if (!url) {
        log("‚ùå –ù–µ —É–∫–∞–∑–∞–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É.");
        alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É");
        return;
      }

      try {
        const csvUrl = extractCsvUrl(url);

        log("üì• –ù–∞—á–∏–Ω–∞—é –∑–∞–≥—Ä—É–∑–∫—É CSV...");
        Papa.parse(csvUrl, {
          download: true,
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            log("üì¶ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:");
            log(JSON.stringify(results, null, 2));
            displayProjects(results.data);
          },
          error: function(err) {
            log("üî• –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: " + err.message);
            alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –¥–∞–Ω–Ω—ã—Ö: " + err.message);
          }
        });

      } catch (e) {
        log("‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: " + e.message);
        alert("–û—à–∏–±–∫–∞: " + e.message);
      }
    }

    function displayProjects(data) {
      const container = document.getElementById("projects");
      container.innerHTML = "";

      if (!data.length) {
        container.innerHTML = "<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>";
        log("‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –Ω–æ –ø—É—Å—Ç—ã–µ.");
        return;
      }

      log(`‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${data.length} –ø—Ä–æ–µ–∫—Ç–æ–≤`);

      data.forEach((row, index) => {
        const div = document.createElement("div");
        div.className = "project";

        div.innerHTML = `
          <h2>${row["–ù–∞–∑–≤–∞–Ω–∏–µ"] || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}</h2>
          <p><strong>–ì–æ–¥:</strong> ${row["–ì–æ–¥"]}</p>
          <p><strong>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</strong> ${row["–ú–∞—Ç–µ—Ä–∏–∞–ª—ã"]}</p>
          <p><strong>–†–∞–∑–º–µ—Ä:</strong> ${row["–†–∞–∑–º–µ—Ä"]}</p>
          <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${row["–û–ø–∏—Å–∞–Ω–∏–µ"]}</p>
          <p><strong>–¢–µ—Ö–Ω–∏–∫–∞:</strong> ${row["–¢–µ—Ö–Ω–∏–∫–∞"]}</p>
          <p><strong>–í—ã—Å—Ç–∞–≤–∫–∏:</strong> ${(row["–í—ã—Å—Ç–∞–≤–∫–∏"] || "").split("; ").join("<br>")}</p>
          <p><strong>–ö–æ–ª–ª–µ–∫—Ü–∏–∏:</strong> ${(row["–ö–æ–ª–ª–µ–∫—Ü–∏–∏"] || "").split("; ").join("<br>")}</p>
          ${row["–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"] ? `<img src="${getImageUrl(row["–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"])}" alt="">` : ""}
        `;

        container.appendChild(div);
      });
    }

    function getImageUrl(link) {
      const match = link.match(/file\/d\/([^\/]+)/);
      if (match && match[1]) {
        return `https://drive.google.com/uc?export=view&id= ${match[1]}`;
      }
      return "";
    }
  </script>

</body>
</html>
